function initFormValidations(){jQuery.validator.setDefaults({onfocusout:!1,onkeyup:!1,onclick:!1,normalizer:function(value){return $.trim(value)},errorPlacement:function(error){$.notify({icon:"now-ui-icons travel_info",message:error.text()},{type:"danger",placement:{from:"top",align:"right"}})}});$("#freeze-account-form").validate({rules:{productaccountno:{digits:!0,maxlength:50},freezeamount:{digits:!0,maxlength:50}},messages:{productaccountno:{required:"You must select an account to proceed"},freezeamount:{required:"Please enter amount to freeze"}},ignore:!1})}function openModal(){$("#freeze-account-modal").modal("show")}function clearFreezeForm(){$("#productaccountno").val(null).trigger("change");$("#freezetype").val(null).trigger("change");$("#freezereason").val(null).trigger("change");$("#freezeReasonOthers").val(null).trigger("change");$("#freezedatetype").val(null).trigger("change");$("#freezedatediv").modal("hide");$(".datetimepicker").val("");$("#freeze-account-form select").val(null).trigger("select2:unselect");$("#freeze-account-form").trigger("reset")}function initDataTable(){$.ajax(url_path+"/LoadProducts").then(function(response){$.each(response,function(index,value){productData[value.id]=value.productName});$("#account-data-table").bootstrapTable("refresh",{url:url_path+"/LoadAccounts"});$("#product-data-table").bootstrapTable("load",response)})}function save(){var form,freezeReasonOthersText,Freezetype,freezedate,startDate,endDate,Amount;if(freezeStatus){$.notify({icon:"now-ui-icons travel_info",message:"Account Has Already Been Frozen"},{type:"danger",placement:{from:"top",align:"right"}});return}if(form=$("#freeze-account-form"),!form.valid())return!1;var input=$("#freeze-file").get(0),customerAccNo=$("#productaccountno").val(),Freezereasontype=$("#freezereason").val();freezeReasonOthersText=Freezereasontype==7?$("#freezeReasonOthersText").val():"";Freezetype=$("#freezetype").val();freezedate=$("#freezedatetype").val();freezedate==2?(startDate=$("#freezestartDate").val(),endDate="9999-99-99"):(startDate=$("#freezestartDate").val(),endDate=$("#freezeendDate").val());Amount=$("#freezeamount").val();input.files.length?swal({title:"Are you sure?",text:"Freeze Details will be saved",type:"question",showCancelButton:!0,confirmButtonColor:"#34D027",confirmButtonText:"Yes, continue",cancelButtonText:"No, stop!",cancelButtonColor:"#ff9800",showLoaderOnConfirm:!0,preConfirm:function(){return new Promise(function(resolve){setTimeout(function(){resolve()},1e3)})}}).then(function(){var formdata=new FormData;formdata.append("document",input.files[0]);formdata.append("title",customerAccNo);$.ajax(url_path+"/../AddDocumentUpload/"+customerAccNo+"/?sendall=true",{method:"POST",contentType:!1,processData:!1,data:formdata}).then(function(){$("#freeze-file").fileinput("clear");$.ajax(url_path+"/../FreezeAccount",{data:{AccountNumber:customerAccNo,StartDate:startDate,EndDate:endDate,AccountName:"",DateTypeId:freezedate,TransactionToPreventId:"",AttachedDocumntId:"",Balance:"",FreezeReason2:freezeReasonOthersText,FreezeTypeId:Freezetype,FreezeAmount:Amount,FreezeReason:Freezereasontype},method:"POST",dataType:"json"}).then(function(){swal({title:"Freeze Account",text:"Freeze Transaction Successfull!",type:"success",allowOutsideClick:!1,allowEscapeKey:!1}).then(clear());$("#freeze-account-data-table").bootstrapTable("refresh",{url:"../Account/LoadFrozenAccounts"});$("#productaccountno").val(null).trigger("change");$("#freezetype").val(null).trigger("change");$("#freezereason").val(null).trigger("change");$("#freezeReasonOthers").val(null).trigger("change");$("#freezedatetype").val(null).trigger("change");$("#freezedatediv").modal("hide");$("#freeze-account-modal").modal("hide");$(".datetimepicker").val("")},function(){swal({title:"Freeze Account",text:"Freeze Account submission encountered an error",type:"error",allowOutsideClick:!1,allowEscapeKey:!1}).then(function(){$("#accountWizard .btn-finish").removeAttr("disabled")})})},function(){swal({title:"Add Freeze Accompany Document",text:"An error occured when adding Freeze Accompany Document!",type:"error"});return})},function(){return}):swal({title:"Are you sure?",text:"Freeze Details will be saved",type:"question",showCancelButton:!0,confirmButtonColor:"#34D027",confirmButtonText:"Yes, continue",cancelButtonText:"No, stop!",cancelButtonColor:"#ff9800",showLoaderOnConfirm:!0,preConfirm:function(){return new Promise(function(resolve){setTimeout(function(){resolve()},1e3)})}}).then(function(){$.ajax(url_path+"/../FreezeAccount",{data:{AccountNumber:customerAccNo,StartDate:startDate,EndDate:endDate,AccountName:"",DateTypeId:freezedate,TransactionToPreventId:"",AttachedDocumntId:"",Balance:"",FreezeReason2:freezeReasonOthersText,FreezeTypeId:Freezetype,FreezeAmount:Amount,FreezeReason:Freezereasontype},method:"POST",dataType:"json"}).then(function(){swal({title:"Freeze Account",text:"Freeze Transaction Successfull!",type:"success",allowOutsideClick:!1,allowEscapeKey:!1}).then(clear());$("#freeze-account-data-table").bootstrapTable("refresh",{url:"../Account/LoadFrozenAccountsForCustomerModule"});$("#productaccountno").val(null).trigger("change");$("#freezetype").val(null).trigger("change");$("#freezereason").val(null).trigger("change");$("#freezeReasonOthers").val(null).trigger("change");$("#freezedatetype").val(null).trigger("change");$("#freezedatediv").modal("hide");$("#freeze-account-modal").modal("hide");$(".datetimepicker").val("")},function(){swal({title:"Freeze Account",text:"Freeze Account submission encountered an error",type:"error",allowOutsideClick:!1,allowEscapeKey:!1}).then(function(){$("#accountWizard .btn-finish").removeAttr("disabled")})})},function(){return});!1}function addRefereeUpdate(button){var form=$("#referee-update-form");form.valid()&&swal({title:"Are you sure?",text:"Referee data will be submitted",type:"question",showCancelButton:!0,confirmButtonColor:"#34D027",confirmButtonText:"Yes, continue",cancelButtonText:"No, stop!",cancelButtonColor:"#ff9800",showLoaderOnConfirm:!0,preConfirm:function(){return new Promise(function(resolve){setTimeout(function(){resolve()},1e3)})}}).then(function(isConfirm){var form_array,form_data,document,form_bag;isConfirm&&($(button).attr("disabled","true"),form_array=form.serializeArray(),form_array=$.map(form_array,function(item){return $.trim(item.value).length!==0?item:null}),form_data={},$.each(form_array,function(index,item){form_data[item.name]=item.value}),document=form.find("input[name=referee-file]").get(0).files[0],form_bag=new FormData,form_bag.append("Document",document),form_bag.append("Data",JSON.stringify(form_data)),$.ajax(url_path+"/AddAccountReferee/"+updateAccount.casaaccountid+"/?sendall=true",{method:"POST",contentType:!1,processData:!1,data:form_bag}).then(function(response){$("#referee-update-data-table").bootstrapTable("load",response);swal({title:"Add Referee",text:"Account referee succesfully added",type:"success",allowOutsideClick:!1,allowEscapeKey:!1}).then(function(){$(button).removeAttr("disabled");utilities.showRefereeUpdateTable();form.trigger("reset");form.find("select").val(null).trigger("change")})},function(){swal({title:"Add Referee",text:"An error was encountered while adding new referee",type:"error",allowOutsideClick:!1,allowEscapeKey:!1}).then(function(){$(button).removeAttr("disabled")})}))},function(){return})}function initDatePicker(){$(".datepicker").length!=0&&$(".datepicker").datetimepicker({format:"YYYY-MM-DD",icons:{time:"now-ui-icons tech_watch-time",date:"now-ui-icons ui-1_calendar-60",up:"fa fa-chevron-up",down:"fa fa-chevron-down",previous:"now-ui-icons arrows-1_minimal-left",next:"now-ui-icons arrows-1_minimal-right",today:"fa fa-screenshot",clear:"fa fa-trash",close:"fa fa-remove"}})}function initSelectTwoConfig(){$.fn.select2.defaults.set("theme","bootstrap4");$.fn.select2.defaults.set("dropdownParent",$("#freeze-account-modal"));$.fn.select2.defaults.set("width","100%");$.fn.select2.defaults.set("allowClear",!0);$.ajax(url_path+"/../LoadFreezeType").then(function(response){$("#freezetype").select2({placeholder:"Select freeze type",data:response})});$(document).on("select2:open",function(){$(".select2-results__options").perfectScrollbar()});$("#freezetype").on("select2:select",function(){$("#freezetype").val()==1?($("#freezeamountdiv").hide(),$("#freezedatetype").prop("disabled",!1),$("#freezeamount").prop("required",!1)):$("#freezetype").val()==3?($("#freezeamountdiv").show(),$("#freezedatetype").prop("disabled",!0),$("#freezedatediv").hide(),$("#freezeamount").prop("required",!0)):($("#freezedatetype").prop("disabled",!1),$("#freezeamountdiv").show(),$("#freezeamount").prop("required",!0))});$("#freezetype").on("select2:unselect",function(){utilities.populateCasaDetails(null)});$.ajax(url_path+"/../ListAccountNoMapDetails").then(function(response){$("#productaccountno").select2({placeholder:"Select Customer Account",data:response})});$.ajax(url_path+"/../LoadFreezeReason").then(function(response){$("#freezereason").select2({placeholder:"Select Freeze Reason",data:response})});$.ajax(url_path+"/../LoadFreezeDateType").then(function(response){$("#freezedatetype").select2({placeholder:"Select Freeze Date Type",data:response})});$("#freezedatetype").on("select2:select",function(){var freezedate=$("#freezedatetype").val();freezedate==3?$("#freezedatediv").show():freezedate==1?$("#freezedatediv").show():freezedate==2&&$("#freezedatediv").hide()});$("#freezereason").on("select2:select",function(){var reasontype=$("#freezereason").val();reasontype==7?$("#freezeReasonOthers").show():$("#freezeReasonOthers").hide()});$("#productaccountno").on("select2:select",function(){var casaAccNo=$("#productaccountno").val();$.ajax(url_path+"/../ConfirmFreezeStatus/"+casaAccNo,{method:"GET",dataType:"json"}).then(function(response){freezeStatus=response?!0:!1})})}var url_path=window.location.pathname,freezeStatus,utilities;url_path.charAt(url_path.length-1)=="/"&&(url_path=url_path.slice(0,url_path.length-1));$(document).ready(function(){initSelectTwoConfig();initFormValidations();$(".modal").perfectScrollbar();$("#freeze-file").fileinput({theme:"fa",allowedFileExtensions:["jpg","png","gif"],msgSizeTooLarge:'File  "{name}"  (<b> { size } KB<\/b >) exceeds maximum allowed upload size of < b > { maxSize } KB<\/b >.Please retry your upload!',msgInvalidFileExtension:"Invalid extension for file. Only { extensions } files are supported.",msgFilePreviewAborted:'File preview aborted for "{name}"'})});$(".datetimepicker").datetimepicker({format:"DD MMMM, YYYY",icons:{time:"fa fa-clock-o",date:"fa fa-calendar",up:"fa fa-chevron-up",down:"fa fa-chevron-down",previous:"fa fa-chevron-left",next:"fa fa-chevron-right",today:"fa fa-screenshot",clear:"fa fa-trash",close:"fa fa-remove",inline:!0}});$("#freezestartDate").on("dp.change",function(){var freezedate=$("#freezedatetype").val();if(freezedate==3){var startDate=$("#freezestartDate").val(),dateString=startDate,myDate=new Date(dateString);myDate.setDate(myDate.getDate()+1);$("#freezeendDate").val(myDate.toDateString().slice(4,myDate.length))}});utilities={populateCasaDetails:function(data){data==null},deleteRefereeUpdateBtnFormatter:function(val,row){return["<button class='btn btn-danger btn-icon' ","onclick='deleteRefereeUpdate("+row.refereeid+")'>","<i class='now-ui-icons ui-1_simple-remove'>","<\/i><\/button>"].join("")},productNameFormatter:function(value){var name=null;return(name=productData[value],!name)?"-":name},freezeApprovalStatusFormatter:function(value){return value?"Approved":"Pending"},editFreezeFormatter:function(value,row){return["<button class='btn editFreezeFormatter btn-info' ","onclick='utilities.initFreezeReversal("+row.accountNumber+")'>","<i class='fas fa-edit'>","<\/i><\/button>"].join("")},freezeTypeFormatter:function(value){var statusString;switch(value){case 1:statusString="Total Freeze";break;case 2:statusString="Partial Freeze";break;case 3:statusString="Indefinite Freeze";break;case 4:statusString="Credit Freeze";break;case 13:statusString="Debit Freeze";break;default:statusString=""}return statusString},initFreezeReversal:function(casaAccNo){if($.ajax(url_path+"/../ConfirmFreezeReversalStatus/"+casaAccNo,{method:"GET",dataType:"json"}).then(function(response){freezeStatus=response?!0:!1}),freezeStatus){$.notify({icon:"now-ui-icons travel_info",message:"Transaction has already been reversed and waiting for approval"},{type:"danger",placement:{from:"top",align:"right"}});return}swal({title:"Are you sure?",text:"Freeze will be Reversed",type:"question",showCancelButton:!0,confirmButtonColor:"#34D027",confirmButtonText:"Yes, continue",cancelButtonText:"No, stop!",cancelButtonColor:"#ff9800",showLoaderOnConfirm:!0,preConfirm:function(){return new Promise(function(resolve){setTimeout(function(){resolve()},1e3)})}}).then(function(){$.ajax(url_path+"/../FreezeAccountReversal/"+casaAccNo,{method:"GET",dataType:"json"}).then(function(response){console.log(response);response?swal({title:"Freeze Account",text:"Freeze Reversal Successfull!",type:"success",allowOutsideClick:!1,allowEscapeKey:!1}).then(clear()):swal({title:"Freeze Account",text:"Transaction has not been previously approved, cannot perform reversal on unapproved transactions",type:"error",allowOutsideClick:!1,allowEscapeKey:!1}).then(clear());$("#freeze-account-data-table").bootstrapTable("refresh",{url:"../Account/LoadFrozenAccountsForCustomerModule"})},function(){swal({title:"Freeze Account",text:"Freeze Reversal encountered an error",type:"error",allowOutsideClick:!1,allowEscapeKey:!1}).then(function(){$("#accountWizard .btn-finish").removeAttr("disabled")})})},function(){return})},freezeTableFormatter:function(index,row,el){var container=$("<div class='row mx-0'><\/div>");container.append($("<div class='col-xs-12 col-md-6'><b>Freeze Start Date:<\/b> &nbsp;&nbsp; "+(moment(row.startDate).format("MMMM DD, YYYY")=="Invalid date"?"-":moment(row.startDate).format("MMMM DD, YYYY"))+"<\/div>"));container.append($("<div class='col-xs-12 col-md-6'><b>Freeze End Date:<\/b> &nbsp;&nbsp; "+(moment(row.endDate).format("MMMM DD, YYYY")=="Invalid date"?"-":moment(row.endDate).format("MMMM DD, YYYY"))+"<\/div> <br> <br> <br>"));container.append($("<div class='col-xs-12 col-md-6'><b>Freeze Amount:<\/b> &nbsp;&nbsp; N"+row.freezeAmount+"<\/div>"));el.append(container)}};